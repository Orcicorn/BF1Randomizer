$(document).ready(function() {
    /* Globals */
    var bDebug = true;                                                         //Show Debug messages?
    var sJSON = 'assets/json/data.min.json';                                    //Path to JSON Data
    var aClasses = ['assault','support','medic','scout'];                       //Static Classes
    var aData = "";                                                             //Stores JSON Data upon load
    var aPrevious = { class:"", primary:"", secondary:"",                       //Store IDs for Previously Used Items
                      gadget1:"",gadget2:"",melee:""};                          //to ensure each pick is unique

    /* Functions ------------------------------------------------------------ */
    function debug(Message) {
        if(bDebug == false) { return null;}
        console.log($.now() + " " + Message);
    }

    function getRandomClass() {
        debug("getRandomClass()");
        var sSelected = aPrevious['class'];
        while(sSelected == aPrevious['class']) {
            var iRandom = Math.floor(Math.random() * aClasses.length);
            sSelected = aClasses[iRandom];
        }
        debug("> " + aClasses[iRandom]);
        aPrevious['class'] = aClasses[iRandom];
        return aClasses[iRandom];
    }

    function getRandomGadgets(Class) {
        debug("getRandomGadgets("+Class+")");
        var aTemp = aData['classes']['all']['gadget'].concat(aData['classes'][Class]['gadget']);
        var aReturn = [];
        for(i=1;i<=2;i++) {
            var sSelected = aPrevious['gadget' + i];
            if(i==2) {
                sSibling = aReturn[0];
            } else {
                sSibling = sSelected;
            }
            while (aPrevious['gadget' + i] == sSelected || sSibling == sSelected) {
                var iRandom = Math.floor(Math.random() * aTemp.length);
                sSelected = aTemp[iRandom][0];
            }
            debug("> [" + aTemp[iRandom][0] + "] " + aTemp[iRandom][1]);
            aPrevious['gadget'+i] = sSelected;
            aReturn.push(sSelected);
        }
        return aReturn;
    }

    function getRandomItem(Class,Type) {
        debug("getRandomItem("+Class+", " + Type + ")");
        var aTemp = aData['classes']['all'][Type].concat(aData['classes'][Class][Type]);
        var sSelected=aPrevious[Type];
        while (aPrevious[Type] == sSelected) {
            var iRandom = Math.floor(Math.random() * aTemp.length);
            sSelected = aTemp[iRandom][0];
        }
        debug("> [" + aTemp[iRandom][0] + "] " + aTemp[iRandom][1]);
        aPrevious['class'] = Class;
        aPrevious[Type] = sSelected;
        return aTemp[iRandom];
    }

    function loadJSONData() {
        debug("loadJSONData()");
        $.getJSON(sJSON, function (data) {
            aData = data;
        });
    }

    /* Routine -------------------------------------------------------------- */
    /* First Load */
    loadJSONData();

    /* Click Events */
    $("#class").click(function() { sClass = getRandomClass(); });
    $("#primary").click(function() { getRandomItem(sClass,"primary"); });
    $("#secondary").click(function() { getRandomItem(sClass,"secondary"); });
    $("#grenade").click(function() { getRandomItem(sClass,"grenade");});
    $("#melee").click(function() { getRandomItem(sClass, "melee");});
    $("#gadget").click(function() { getRandomGadgets(sClass);});

    $("#reset").click(function() { console.log("");});
});